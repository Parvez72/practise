const request = require("request");

const getBotMappings = (token) => {

    return new Promise((resolve) => {
        const options = {
            method: 'GET',
            url: 'https://app.yellowmessenger.com/api/sso/bot',
            qs: {offset: '0', limit: '100', botType: 'sandbox', refresh: 'true'},
            headers: {'x-auth-token': token}
        };

        request(options, function (error, response, body) {
            if (error) {
                return resolve({success: false, message: 'Unexpected Error', data: []})
            }
            if (response.statusCode === 401) {
                return resolve({success: false, message: 'Unauthorised, Please check your apiKey', data: []})
            }
            body = JSON.parse(body);
            resolve({success: true, message: 'Bots Fetched Successfully', data: body.data.botMappings});
        });
    });
};

const gitInit = (token, bot) => {

    return new Promise((resolve) => {
        const options = {
            method: 'POST',
            url: 'https://app.yellowmessenger.com/api/sso/git/init',
            qs: {bot},
            headers: {'x-auth-token': token}
        };
        request(options, function (error, response, body) {
            resolve(JSON.parse(body));
        });
    });
};


module.exports = {
    getBotMappings,
    gitInit
};




